name: Diagnóstico do GitHub CLI

on:
  # Gatilho para teste manual
  workflow_dispatch:

jobs:
  debug-gh-environment:
    runs-on: ubuntu-latest
    steps:
      
      - name: 1. Qual 'gh' esta no PATH?
        run: |
          echo "O sistema esta usando este 'gh':"
          which gh
          echo "-----------------------------------"
          
      - name: 2. Qual a versao REAL desse 'gh'?
        run: |
          echo "A versao reportada e:"
          gh --version
          echo "-----------------------------------"

      - name: 3. Quais comandos o 'gh codespace' realmente tem?
        run: |
          echo "Os comandos disponiveis sao:"
          # Usamos 'gh codespace --help' para obter a lista
          gh codespace --help
          echo "-----------------------------------"

      - name: 4. Tentativa de rodar o update (Instalacao Forcada)
        run: |
          echo "Iniciando a atualizacao..."
          sudo apt-get update -y
          # Esta é a instalação oficial via 'curl' que tentamos antes
          curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
          sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
          sudo apt-get update -y
          sudo apt-get install -y gh
          echo "Atualizacao concluida."
          echo "-----------------------------------"
          
      - name: 5. Qual o 'gh' DEPOIS do update?
        run: |
          echo "DEPOIS do update, o sistema usa este 'gh':"
          which gh
          echo "A versao DEPOIS do update e:"
          gh --version
          echo "-----------------------------------"

      - name: 6. O que o 'gh' (novo) sabe sobre o comando 'start'?
        run: |
          echo "Pedindo ajuda para o comando 'gh codespace start'..."
          # Se o 'gh' foi atualizado, este comando vai funcionar
          # Se nao, ele vai falhar (o que e uma resposta)
          gh codespace start --help
